#!/usr/bin/env bash

function main {
  local cnt_proc="1"
  local cnt_args="1"

  # check if number of processess is specified
  if [[ "${1:-}" =~ ^[1-9][0-9]*$ ]]; then
    cnt_proc="$1"; shift
    # check if number of args is specified
    if [[ "${1:-}" =~ ^[1-9][0-9]*$ ]]; then
      cnt_args="$1"; shift
    fi
  fi

  if [[ -z "${1:-}" ]]; then
    echo "ERROR: missing command" 1>&2
    return 1
  fi
  local cmd="$1"; shift

  # check if any arguments
  if [[ "$#" -gt 0 ]]; then
    echo "$@"
  else
    # otherwise read arguments from stdin
    cat
  fi | xargs -n "$cnt_args" -P "$cnt_proc" bash -c "$cmd" "" 
}

source sub "$0" "$@"
